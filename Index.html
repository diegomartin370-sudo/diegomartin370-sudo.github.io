<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Noticias Análisis - Supabase</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.58.0/dist/umd/supabase.min.js"></script>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    #message { margin-top: 20px; font-weight: bold; color: red; }
</style>
</head>
<body>

<h1>Noticias Análisis</h1>
<div id="message">Cargando datos...</div>
<table id="noticiasTable" style="display:none;">
    <thead>
        <tr id="tableHeader"></tr>
    </thead>
    <tbody id="tableBody"></tbody>
</table>

<script>
const supabaseUrl = 'https://sjfcglxgwweajbpzvkzr.supabase.co';
const supabaseKey = 'sb_publishable_00Oyv48uH-Xw1EcVR0_bPQ_p4Kv76Sk';

// ✅ Inicialización correcta con UMD
const supabase = Supabase.createClient(supabaseUrl, supabaseKey);

const messageDiv = document.getElementById('message');
const table = document.getElementById('noticiasTable');
const headerRow = document.getElementById('tableHeader');
const tbody = document.getElementById('tableBody');

function renderTable(data) {
    if (!data || data.length === 0) {
        table.style.display = "none";
        messageDiv.textContent = "No hay registros o no tienes permisos para verlos.";
        return;
    }

    headerRow.innerHTML = '';
    tbody.innerHTML = '';

    const keys = Object.keys(data[0]);
    keys.forEach(key => {
        const th = document.createElement('th');
        th.textContent = key;
        headerRow.appendChild(th);
    });

    data.forEach(row => {
        const tr = document.createElement('tr');
        keys.forEach(key => {
            const td = document.createElement('td');
            td.textContent = row[key];
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });

    messageDiv.textContent = "";
    table.style.display = "table";
}

async function cargarNoticias() {
    messageDiv.textContent = "Cargando datos...";
    table.style.display = "none";

    console.log('Supabase object:', supabase);

    try {
        const { data, error } = await supabase
            .from('noticias_analisis')
            .select('*');

        console.log('Data obtenida:', data);
        console.log('Error (si hay):', error);

        if (error) {
            messageDiv.textContent = "Error al cargar datos: " + error.message;
        } else {
            renderTable(data);
        }
    } catch (e) {
        console.error('Excepción al conectar con Supabase:', e);
        messageDiv.textContent = "Error inesperado al conectar con la base de datos.";
    }
}

// ✅ Cargar al inicio y cada 10 segundos
cargarNoticias();
setInterval(cargarNoticias, 10000);
</script>

<p><em>Recomendación: abrir este archivo desde un <strong>servidor local</strong> (Live Server o python -m http.server) para evitar problemas de CORS.</em></p>

</body>
</html>
